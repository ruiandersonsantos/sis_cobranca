

-- BANCOS
SELECT 
	A01.UKEY CHAVE_PRIMARIA_ORIGEM,
	A01_001_C CODIGO,
	A01_002_C NOME_BANCO,
	A01_003_C NOME_BANCO_COMPLETO
FROM F13(NOLOCK)
INNER JOIN f12(NOLOCK) ON f12.ukey = f13.F12_UKEY
INNER JOIN A01(NOLOCK) ON A01.UKEY = F13.A01_UKEY
WHERE (F13_009_B - F13_021_B - F13_029_B - F13_025_B) > 0.10 -- PARCELA EM ABERTO
	AND F13_003_D < GETDATE() -- VENCIMENTO MENOR QUE HOJE
	AND F12_016_C = '001'
	AND ISNULL(F13_997_D, '19990101') < GETDATE() -- PRORROGA플O MENOR QUE HOJE
GROUP BY
	A01.UKEY,
	A01_001_C,
	A01_002_C,
	A01_003_C


-- AGENCIA
SELECT 
	A38.UKEY CHAVE_PRIMARIA_ORIGEM,
	A38_001_C CODIGO_AGENCIA,
	A38_003_C NOME_AGENCIA,
	A38.A01_UKEY CHAVE_PRIMARIA_BANCO,
	A38.A23_UKEY CHAVE_PRIMARIA_CIDADE
FROM F13(NOLOCK)
INNER JOIN f12(NOLOCK) ON f12.ukey = f13.F12_UKEY
INNER JOIN A38(NOLOCK) ON A38.UKEY = F13.A38_UKEY
WHERE (F13_009_B - F13_021_B - F13_029_B - F13_025_B) > 0.10 -- PARCELA EM ABERTO
	AND F13_003_D < GETDATE() -- VENCIMENTO MENOR QUE HOJE
	AND F12_016_C = '001'
	AND ISNULL(F13_997_D, '19990101') < GETDATE() -- PRORROGA플O MENOR QUE HOJE
GROUP BY
	A38.UKEY,
	A38_001_C,
	A38_003_C,
	A38.A01_UKEY,
	A38.A23_UKEY


-- CONTA_BANCARIAS
SELECT 
	A39.UKEY CHAVE_PRIMARIA_ORIGEM,
	A39_001_C NUMERO_CONTA,
	A39.A38_UKEY CHAVE_PRIMARIA_AGENCIA

FROM F13(NOLOCK)
INNER JOIN f12(NOLOCK) ON f12.ukey = f13.F12_UKEY
INNER JOIN A39(NOLOCK) ON A39.UKEY = F13.A39_UKEY
WHERE (F13_009_B - F13_021_B - F13_029_B - F13_025_B) > 0.10 -- PARCELA EM ABERTO
	AND F13_003_D < GETDATE() -- VENCIMENTO MENOR QUE HOJE
	AND F12_016_C = '001'
	AND ISNULL(F13_997_D, '19990101') < GETDATE() -- PRORROGA플O MENOR QUE HOJE
GROUP BY
	A39.UKEY,
	A39_001_C,
	A39.A38_UKEY




-- Paises
SELECT A22.UKEY CHAVE_PRIMARIA
	,A22_001_C PAIS
FROM A22(NOLOCK)

-- estados
SELECT A23.UKEY CHAVE_PRIMARIA_ORIGEM
	,A23_001_C ESTADO
	,A23_002_C SIGLA
	,A22_UKEY CHAVE_PAIS
FROM A23(NOLOCK)

-- cidades
SELECT A24.UKEY CHAVE_PRIMARIA_ORIGEM
	,A24_001_C MUNICIPIO
	,A24.A23_UKEY CHAVE_ESTADO
FROM F13(NOLOCK)
INNER JOIN F12(NOLOCK) ON F12.UKEY = F13.F12_UKEY
INNER JOIN A03(NOLOCK) ON A03.UKEY = F12.F12_UKEYP
INNER JOIN A24(NOLOCK) ON A24.UKEY = A03.A24_UKEY
WHERE (F13_009_B - F13_021_B - F13_029_B - F13_025_B) > 0.10 -- PARCELA EM ABERTO
	AND F13_003_D < GETDATE() -- VENCIMENTO MENOR QUE HOJE
	AND F12_016_C = '001'
	AND ISNULL(F13_997_D, '19990101') < GETDATE() -- PRORROGA플O MENOR QUE HOJE
GROUP BY A24.UKEY
	,A24_001_C
	,A24.A23_UKEY

-- clientes
SELECT A03.UKEY CHAVE_PRIMARIA_ORIGEM
	,A03_001_C CODIGO
	,A03_002_C RAZAO
	,A03_003_C NOME_FANTASIA
	,A03_010_C DOCUMENTO
	,A03_005_C ENDERECO
	,A03_004_C BAIRRO
	,A03_158_C COMPLEMENTO
	,A03_034_C DDD
	,A03_035_C TELEFONE
	,A03_037_C CONTATO
	,A03_043_C EMAIL
	,A22_UKEY CHAVE_PAIS
	,A23_UKEY CHAVE_ESTADO
	,A24_UKEY CHAVE_MUNICIPIO
FROM F13(NOLOCK)
INNER JOIN F12(NOLOCK) ON F12.UKEY = F13.F12_UKEY
INNER JOIN A03(NOLOCK) ON A03.UKEY = F12.F12_UKEYP
WHERE (F13_009_B - F13_021_B - F13_029_B - F13_025_B) > 0.10 -- PARCELA EM ABERTO
	AND F13_003_D < GETDATE() -- VENCIMENTO MENOR QUE HOJE
	AND F12_016_C = '001'
	AND ISNULL(F13_997_D, '19990101') < GETDATE() -- PRORROGA플O MENOR QUE HOJE
GROUP BY A03.UKEY
	,A03_001_C
	,A03_002_C
	,A03_003_C
	,A03_010_C
	,A03_005_C
	,A03_004_C
	,A03_158_C
	,A03_034_C
	,A03_035_C
	,A03_037_C
	,A03_043_C
	,A22_UKEY
	,A23_UKEY
	,A24_UKEY

-- titulos
SELECT F12.UKEY CHAVE_PRIMARIA_ORIGEM
	,F12_001_C NUMERO_TITULO
	,F12_019_C SERIE_TITULO
	,CAST(F12_002_D AS DATE) EMISSAO
	,CAST(F12_013_B AS MONEY) VALOR
FROM F13(NOLOCK)
INNER JOIN f12(NOLOCK) ON f12.ukey = f13.F12_UKEY
WHERE (F13_009_B - F13_021_B - F13_029_B - F13_025_B) > 0.10 -- PARCELA EM ABERTO
	AND F13_003_D < GETDATE() -- VENCIMENTO MENOR QUE HOJE
	AND F12_016_C = '001'
	AND ISNULL(F13_997_D, '19990101') < GETDATE() -- PRORROGA플O MENOR QUE HOJE
GROUP BY F12.UKEY
	,F12_001_C
	,F12_019_C
	,F12_002_D
	,F12_013_B

-- parcelas
SELECT 
	 F13.UKEY CHAVE_PRIMARIA_ORIGEM
	,F13_001_C NUMERO_PARCELA
	,CAST(F13_003_D AS DATE) DATA_VENCIMENTO
	,CAST(F13_009_B AS MONEY) VALOR_LIQUIDO
	,CAST(F13_010_B AS MONEY) VALOR_BRUTO
	,CAST(F13_029_B AS MONEY) VALOR_ESTORNO
	,CAST(F13_025_B AS MONEY) VALOR_REPARCELAMENTO
	,CAST(F13_021_B AS MONEY) VALOR_QUITADO
	,CAST(ISNULL(F13_997_D, '19990101') AS DATE) DATA_PRORROGACAO
	,CAST((F13_009_B - F13_021_B - F13_029_B - F13_025_B) AS MONEY) VALOR_ABERTO
	,ISNULL(F13.A01_UKEY, 'NAO_INFORMADO') CHAVE_BANCO
	,ISNULL(F13.A38_UKEY, 'NAO_INFORMADO') CHAVE_AGENCIA
	,ISNULL(F13.A39_UKEY, 'NAO_INFORMADO') CHAVE_CONTA_BANCARIA
	,F12.UKEY CHAVE_PRIMARIA_TITULO
FROM F13(NOLOCK)
INNER JOIN f12(NOLOCK) ON f12.ukey = f13.F12_UKEY
WHERE (F13_009_B - F13_021_B - F13_029_B - F13_025_B) > 0.10 -- PARCELA EM ABERTO
	AND F13_003_D < GETDATE() -- VENCIMENTO MENOR QUE HOJE
	AND F12_016_C = '001'
	AND ISNULL(F13_997_D, '19990101') < GETDATE() -- PRORROGA플O MENOR QUE HOJE